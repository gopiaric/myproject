!function(a){"use strict";var b=a.onerror;a.onerror=function(a,c,d,e,f){if(c=c||"",c.indexOf("//www.bizcardmaker.com/")!==-1){if("function"==typeof ga){var g=a;"undefined"!=typeof f&&"undefined"!=typeof f.message&&(g=f.message),g+=" @ "+c+":"+d+":"+e,ga("send","exception",{exDescription:g})}return"function"==typeof b&&b(a,c,d,e,f)}}}(window),function(){"use strict";function a(a){var b=window.location.hash.substr(1),c=b.substr(b.indexOf(a+"=")).split("&")[0].split("=")[1];return c?c:null}function b(a,b){for(var c;a&&a!==document;){if(!a.parentNode)return null;if(c=a.parentNode.querySelectorAll(b),[].indexOf.call(c,a)!==-1)return a;a=a.parentNode}return null}function c(a,b){if(!a.className)return!1;var c=" "+a.className+" ";return b=" "+b+" ",c.indexOf(b)!==-1}function d(a,b){return c(a,b)?a.className:(a.className&&(b=" "+b),a.className+=b,a.className)}function e(a,b){var c=" "+b,d=b+" ";return a.className.indexOf(c)!==-1?a.className=a.className.replace(c,""):a.className.indexOf(d)!==-1?a.className=a.className.replace(d,""):a.className=a.className.replace(b,""),a.className}window.util={closest:b,hash:a,hasClass:c,addClass:d,removeClass:e}}();var printchompUrl="http://sandbox.printchomp.com",apiUrl="http://localhost:8080",env="local";document.domain.indexOf("development.")!==-1&&(env="dev"),document.domain.indexOf("staging.")!==-1&&(env="stage"),document.domain.indexOf("www.")!==-1&&(env="live"),"dev"===env&&(apiUrl="https://dev-bizcardmaker.rhcloud.com"),"live"!==env&&"stage"!==env||(apiUrl="https://live-bizcardmaker.rhcloud.com",printchompUrl="https://printchomp.com"),function(){"use strict";$(document).on("opened","[data-reveal]",function(){$(document.body).addClass("modal-opened")}),$(document).on("closed","[data-reveal]",function(){$(document.body).removeClass("modal-opened")})}(),function(){"use strict";if("object"==typeof localStorage)try{localStorage.setItem("localStorage",1),localStorage.removeItem("localStorage")}catch(a){window.Storage.prototype._setItem=window.Storage.prototype.setItem,window.Storage.prototype.setItem=function(){}}var a=navigator.userAgent.indexOf("Safari")!==-1&&navigator.userAgent.indexOf("Chrome")===-1,b=document.querySelector(".warning-safari");a&&(b.className+="warning-safari-show")}(),function(){"use strict";var a=function(a){window.util.closest(a.target,".js-order-btn-psprint")&&ga("send","event","Orders","Clicked PsPrint button")};document.body.addEventListener("click",a)}(),function(){"use strict";var a="http://www.shareasale.com/r.cfm?b=283670&u=1215865&m=22819&urllink=&afftrack=",b=(document.querySelector(".js-order-btn-psprint"),function(b){window.util.closest(b.target,".js-order-btn-psprint")&&window.open(a,"psprint")});document.body.addEventListener("click",b)}(),function(){"use strict";var a=document.querySelector(".js-modal-logaster");if(a){var b=function(b){window.util.closest(b.target,".js-btn-logaster")&&$(a).foundation("open")},c=function(b){b.target.classList.contains("js-close-modal")&&($(a).foundation("close"),b.preventDefault())};a.addEventListener("click",c),document.body.addEventListener("click",b)}}(),function(){"use strict";var a=document.querySelector("#modal-affiliate");if(a){var b=a.querySelector(".js-checkbox-affiliate-hide"),c="bizcardmaker-affiliate",d=null,e=JSON.stringify({modalHide:!1,modalTime:Date.now()}),f=864e5,g=function(g){window.util.closest(g.target,".js-affiliate-modal")&&(null===d&&(d=window.localStorage.getItem(c)||e,d=JSON.parse(d),"object"!=typeof d&&(d=JSON.parse(e))),d.modalHide===!0&&Date.now()-d.modalTime>f&&(d.modalHide=!1,b.checked=!1),d.modalHide!==!0&&($(a).foundation("open"),ga("send","event","Affiliate","View affiliate modal")))},h=function(b){b.target.classList.contains("js-close-modal")&&($(a).foundation("close"),b.preventDefault())},i=function(a){a.target.checked?(d.modalHide=!0,d.modalTime=Date.now()):d.modalHide=!1,window.localStorage.setItem(c,JSON.stringify(d))};a.addEventListener("click",h),document.body.addEventListener("click",g),b.addEventListener("change",i)}}(),function(){"use strict";var a=function(a){if(window.util.closest(a.target,".js-newsletter-subscribe")){var b=document.querySelector(".card-content"),c=b.querySelector(".email p").textContent.trim(),d=new window.XMLHttpRequest;d.open("POST",apiUrl+"/newsletter/subscribe"),d.setRequestHeader("Content-Type","application/json;charset=UTF-8"),d.send(JSON.stringify({email:c}))}};document.body.addEventListener("click",a)}(),function(){"use strict";function a(){return(c=window.util.hash("theme"))?(b=d.querySelector(".active"),b&&window.util.removeClass(b,"active"),b=d.querySelector(".js-"+c),void(b&&window.util.addClass(b,"active"))):void d.querySelector(".theme-item").click()}var b,c="",d=document.querySelector(".themes-box");d&&(a(),window.addEventListener("hashchange",a,!1))}(),window.GeneratePdf=function(){"use strict";var a={card:[3.75,2.25],margin:.35,trim:.125},b=a.card[0],c=a.card[1],d=a.trim,e=d+a.margin,f=a.margin-d,g=.06,h=[{x:e,y:g,x1:e,y1:e-g},{x:g,y:e,x1:e-g,y1:e},{x:b+f,y:g,x1:b+f,y1:e-g},{x:b+f+g,y:e,x1:b+2*a.margin-g,y1:e},{x:e,y:c+f+g,x1:e,y1:c+2*a.margin-g},{x:g,y:c+f,x1:e-g,y1:c+f},{x:b+f,y:c+f+g,x1:b+f,y1:c+2*a.margin-g},{x:b+f+g,y:c+f,x1:b+2*a.margin-g,y1:c+f}];return function(d,e){var f=new jsPDF("landscape","in",[b+2*a.margin,c+2*a.margin]);f.addImage(e,"JPEG",a.margin,a.margin,b,c),h.forEach(function(a){f.setLineWidth(.01),f.line(a.x,a.y,a.x1,a.y1)}),f.save(d)}}();var app=angular.module("businessCardMaker",["ngRoute","angular-meditor"]);app.run(["$rootScope",function(a){"use strict";a.root={}}]),app.directive("fileread",[function(){"use strict";return{scope:{fileread:"="},link:function(a,b){b.bind("change",function(b){a.$apply(function(){a.fileread=b.target.files[0]})})}}}]),app.directive("drModel",["$document","$timeout",function(a,b){"use strict";return{template:'<div class="dr-container"><div class="drag-handle"></div><div class="resize-handle"></div><div ng-transclude></div></div>',scope:{drModel:"=",drContainer:"@",drGrid:"@"},replace:!0,transclude:!0,link:function(a,b){var c="dr-active",d="dr-handle-show",e=document.getElementsByTagName("body")[0],f=e;a.drContainer&&(f=document.querySelector(a.drContainer));var g,h,i=b[0].querySelector(".drag-handle"),j=b[0].querySelector(".resize-handle"),k=["webkitTransform","msTransform","transform"],l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=!1,u=!1,v=a.drGrid,w=function(a){return Math.floor(a/v)*v},x=function(a){var b=i.getBoundingClientRect(),c=f.getBoundingClientRect(),d=b.top,e=b.left;r=d-c.top,r=0-w(r),s=c.top+c.height-d-b.height,s=w(s),p=e-c.left,p=0-w(p),q=c.left+c.width-e-b.width,q=w(q)},y=function(a){return a%v===0?a:a-a%v},z=function(a){if(t||u){if(a.preventDefault(),n=y(a.touches[0].pageX-l),o=y(a.touches[0].pageY-m),n>q&&(n=q),o>s&&(o=s),t){n<p&&(n=p),o<r&&(o=r);var c="translate3d("+n+"px ,"+o+"px, 0)";angular.forEach(k,function(a){b.css(a,c)})}if(u){var d=b._startHeight+o;b.css("height",d);var e=b._startWidth+n;b.css("width",e)}}},A=function(f){if(t||u){if(t){t=!1,angular.forEach(k,function(a){b.css(a,"")});var g=n,h=o;"absolute"===b.css("position")?(g+=b[0].offsetLeft,h+=b[0].offsetTop):(b.css("left")&&"auto"!==b.css("left")&&(g=parseInt(b.css("left"),10)+n),b.css("top")&&"auto"!==b.css("top")&&(h=parseInt(b.css("top"),10)+o)),b.css({top:h,left:g,bottom:"auto",right:"auto"}),a.drModel&&(a.drModel.x=g,a.drModel.y=h)}u&&(u=!1,a.drModel&&(a.drModel.width=parseInt(b.css("width")),a.drModel.height=parseInt(b.css("height")))),e.classList.remove(c),b[0].classList.remove(d)}},B=function(a){var f=a.target;x(),n=o=0,l=a.touches[0].pageX-n,m=a.touches[0].pageY-o,f===j?(u=!0,b._startHeight=parseInt(b.css("height")),b._startWidth=parseInt(b.css("width"))):t=!0,e.classList.add(c),b[0].classList.add(d)},C=function(a){return t?(e.scrollTop=g,void(e.scrollLeft=h)):(g=e.scrollTop,void(h=e.scrollLeft))},D=function(a){return a.touches=[{clientX:a.clientX,clientY:a.clientY,pageX:a.pageX,pageY:a.pageY}],a},E=function(){a.drModel.x=a.drModel.x||"",b.css({left:a.drModel.x}),a.drModel.y=a.drModel.y||"",b.css({top:a.drModel.y}),a.drModel.width=a.drModel.width||"",b.css({width:a.drModel.width}),a.drModel.height=a.drModel.height||"",b.css({height:a.drModel.height})};a.$watch("drModel",E,!0),j.addEventListener("mousedown",function(a){B(D(a))}),j.addEventListener("touchstart",B),i.addEventListener("mousedown",function(a){B(D(a))}),i.addEventListener("touchstart",B),document.addEventListener("mousemove",function(a){z(D(a))}),document.addEventListener("touchmove",z),document.addEventListener("mouseup",A),document.addEventListener("touchend",A),window.addEventListener("scroll",C)}}}]),app.controller("MainCtrl",["$rootScope","$scope","$routeParams","$location","$timeout","$q",function(a,b,c,d,e,f){"use strict";var g,h=b.model={};h.cardPictureFile="",h.cardPicture="",h.imageData="",h.imageFilename="bizcardmaker-com",h.imageExt=".jpg",h.pdfData="",h.pdfFilename="bizcardmaker-com.pdf",h.loadingCard=!1,h.storeDefaults={card:{name:"John Doe",position:"Position",organization:"Organization",location:"City, State",phone:"(123) 555-1234",email:"john.doe@cmail.com",url:"www.john-doe.com"},position:{picture:{},person:{},details:{},email:{},url:{}}},h.store={card:{},position:{}},angular.copy(h.storeDefaults,h.store);var i=window.localStorage.getItem("bizcardmaker-store");i&&angular.extend(h.store,angular.fromJson(i));var j=function(a,b){var c=null;return function(){var d=this,e=arguments;clearTimeout(c),c=setTimeout(function(){a.apply(d,e)},b)}};b.$watch("model.store",j(function(a){window.localStorage.setItem("bizcardmaker-store",angular.toJson(a))},500),!0);var k=function(){if(document.querySelector(".card-preview")){var a=document.querySelector(".card-preview").querySelectorAll("*");angular.forEach(a,function(a){a.removeAttribute("style")})}};b.ResetCard=function(a){if(k(),a)angular.copy(h.storeDefaults.position,h.store.position);else{var b=h.store.theme;angular.copy(h.storeDefaults,h.store),h.store.theme=b}window.localStorage.removeItem("bizcardmaker-store")},h.store.theme&&d.search("theme",h.store.theme),b.$on("$locationChangeStart",function(){var a=d.search().theme;a!==h.store.theme&&b.ResetCard(!0),h.store.theme=a}),b.$watch("model.cardPictureFile",function(){if(h.cardPictureFile){var a=/image.*/;if(h.cardPictureFile.type.match(a)){var b=new FileReader;b.onload=function(){e(function(){h.cardPicture=b.result})},b.readAsDataURL(h.cardPictureFile)}else window.alert("File not supported!")}});var l=function(a){var b=window.getComputedStyle(a.parentNode,null),c=window.getComputedStyle(a,null),d=parseFloat(c.fontSize),e=parseFloat(b.fontSize),f=["left","top","width","height"],g="",h={};f.forEach(function(b){if(g=a.style[b],g&&g.indexOf("em")===-1){var f=parseFloat(c[b]),i=f/e,j=d/e;i+=(i-i*j)/j,h[b]=i+"em"}}),Object.keys(h).forEach(function(b){a.style[b]=h[b]}),"font"===a.tagName.toLowerCase()&&c.fontSize.indexOf("em")===-1&&(a.style.fontSize=d/e+"em")},m={1:"10",2:"13",3:"16",4:"18",5:"24",6:"32",7:"48"},n=function(a){var b,c=a.querySelectorAll("[contenteditable]");angular.forEach(c,function(a){b=a.querySelectorAll("*"),angular.forEach(b,function(a){"font"===a.tagName.toLowerCase()&&(a.style.fontSize=m[a.size]+"px"),l(a)})});var d=a.querySelectorAll(".card-item[style]"),e=a.querySelector(".card-picture[style]");angular.forEach(d,function(a){l(a)}),e&&l(e)};b.generatePicture=function(a){a=a||function(){};var b=f.defer();window.getSelection().removeAllRanges();var c=document.querySelector(".js-card-container").cloneNode(!0);return c.classList.add("card-invisible"),document.body.appendChild(c),n(c),c.classList.add("card-big"),h.loadingCard=!0,html2canvas(c,{letterRendering:!0}).then(function(d){document.body.removeChild(c),h.loadingCard=!1,b.resolve(d),a(d)}),b.promise},b.DownloadPdf=function(){b.generatePicture().then(function(a){var b=a.toDataURL("image/jpeg",1);window.GeneratePdf(h.pdfFilename,b)}),ga("send","event","Download","Download PDF",h.store.theme)},b.DownloadPicture=function(){b.generatePicture().then(function(a){a.toBlob(function(a){var b=h.imageFilename+"-"+h.store.theme+h.imageExt;saveAs(a,b);var c=$(".card-container");c[0].scrollIntoView(!0)},"image/jpeg")}),ga("send","event","Download","Download picture",h.store.theme)},h.openedModal=!1,h.order={},b.OpenOrderModal=function(){var a=document.querySelector(".card-content"),c=Math.ceil(a.scrollWidth),d=Math.ceil(a.scrollHeight),e=Math.ceil(a.clientWidth),f=Math.ceil(a.clientHeight),i=Math.abs(c-e)>5,j=Math.abs(d-f)>5,k=i||j,l="Oops! \nSome of the details on your card will be cut during the printing process. \n\nTo make sure this doesn't happen, please try: \n* Shortening some of text lines \n* Moving the elements closer to the card center \n";return k?(window.alert(l),ga("send","event","Orders","Overflow error"),!1):(h.openedModal||(h.order.email=$(".email p",a).text().trim(),h.order.name=$(".fn",a).text().trim(),h.order.phone=$(".tel",a).text().trim(),h.order.city=$(".locality",a).text().trim(),h.openedModal=!0),void b.generatePicture().then(function(a){g.foundation("open");var b=a.toDataURL("image/jpeg");h.imagePreview=b}))};var o=1,p=0;b.$on("$includeContentLoaded",function(){if(p++,p===o){g=$(".modal-order"),$(document.querySelector(".card-editor")).foundation();var a=document.querySelector(".card-content");a&&a.addEventListener("scroll",function(b){a.scrollTop=0,a.scrollLeft=0})}})}]),angular.module("businessCardMaker").run(["$templateCache",function(a){"use strict";a.put("views/cardeditor.html",'<h2>\n  Customize your business card\n\n  <button type="button" class="button small muted btn-reset" ng-click="ResetCard()" title="Undo all the styling changes you made. The text and logo will stay the same.">\n    <i class="fa fa-undo"></i>\n    Reset changes\n  </button>\n</h2>\n\n<div class="card-container js-card-container" ng-class="{ \' state-loading\': model.loadingCard }">\n  <div class="card-preview {{ model.store.theme }}">\n\n    <div class="card-content">\n\n      <input type="file" id="picture-upload" class="file-upload" fileread="model.cardPictureFile">\n\n      <div class="card-picture" dr-container=".card-content" dr-model="model.store.position.picture" dr-grid="10">\n\n        <label for="picture-upload" ng-class="{ \'no-picture\': !model.cardPicture }" title="Click to upload your own logo">\n\n          <i class="fa fa-picture-o"></i>\n          <span>Upload your logo</span>\n\n          <img ng-src="{{ model.cardPicture }}">\n\n        </label>\n      </div>\n\n      <div class="card-item person" dr-container=".card-content" dr-model="model.store.position.person" dr-grid="10">\n\n        <p meditor ng-model="model.store.card.name" class="fn"></p>\n        <p meditor ng-model="model.store.card.position" class="title"></p>\n\n      </div>\n\n      <div class="card-item details" dr-container=".card-content" dr-model="model.store.position.details" dr-grid="10">\n\n        <p meditor ng-model="model.store.card.organization" class="org"></p>\n        <p meditor ng-model="model.store.card.location" class="location"></p>\n        <p meditor ng-model="model.store.card.phone" class="tel"></p>\n\n      </div>\n\n      <div class="card-item email" dr-container=".card-content" dr-model="model.store.position.email" dr-grid="10">\n\n        <p meditor ng-model="model.store.card.email"></p>\n\n      </div>\n\n      <div class="card-item url" dr-container=".card-content" dr-model="model.store.position.url" dr-grid="10">\n\n        <p meditor ng-model="model.store.card.url"></p>\n\n      </div>\n\n    </div>\n\n  </div>\n\n</div>\n\n<ul class="download-buttons">\n  <li class="order-btn order-btn-psprint">\n\n    <button class="button secondary js-order-btn-psprint" ng-click="DownloadPicture()">\n      <i class="fa fa-shopping-cart"></i>\n      Cards starting at $9.15!\n\n      <small>\n        Get your business cards printed and delivered at the best quality and price!\n      </small>\n\n      <!--<span class="button-promo">\n        <strong>60% Off!</strong> Ends 06.15.16\n      </span>-->\n    </button>\n\n    <p class="partner-text">\n      Powered by\n      <a href="http://www.shareasale.com/r.cfm?b=283670&u=1215865&m=22819&urllink=&afftrack=" target="_blank">\n        PsPrint\n      </a>\n    </p>\n\n  </li>\n  <li>\n\n    <a data-toggle="drop-downloads" class="button muted button-download js-download-dropdown-btn float-right">\n      <i class="fa fa-arrow-circle-o-down"></i>\n      <span>Download as...</span>\n    </a>\n\n    <div id="drop-downloads" class="dropdown-pane bottom dropdown-download-files" data-dropdown data-close-on-click="true">\n      <button type="button" ng-click="DownloadPdf()" class="js-newsletter-subscribe button-download-file">\n        <i class="fa fa-file-text"></i>\n        Download as PDF\n      </button>\n\n      <button type="button" ng-click="DownloadPicture()" class="js-newsletter-subscribe button-download-file">\n        <i class="fa fa-picture-o"></i>\n        Download as JPEG\n      </button>\n    </div>\n\n  </li>\n</ul>\n\n')}]);
//# sourceMappingURL=app.js.map